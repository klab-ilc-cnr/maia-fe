<div class="grid">
  <div class="col-12">
    <div class="card">
      <div class="page-header">
        <h5>
          <div *ngIf="isEditUser(); else elseBlock">User detail</div>
          <ng-template #elseBlock>New user</ng-template>
        </h5>
      </div>
      <div class="card-body p-fluid">
        <form #userDetailsForm="ngForm" (ngSubmit)="onSubmit()" #userForm="ngForm">
          <div class="form-group">
            <label for="name">Name *</label>
            <input
              type="text"
              [(ngModel)]="user.name"
              class="form-control"
              id="name"
              name="name"
              placeholder="Enter your name"
              required
              #name="ngModel"
              [disabled]="!canManageUsers"
            />
            <div
              *ngIf="name.invalid && (name.dirty || name.touched)"
              class="alert alert-danger"
            >
            Name is mandatory
            </div>
          </div>
          <div class="form-group">
            <label for="surname">Surname *</label>
            <input
              type="text"
              [(ngModel)]="user.surname"
              class="form-control"
              id="surname"
              name="surname"
              placeholder="Enter your surname"
              required
              #surname="ngModel"
              [disabled]="!canManageUsers"
            />
            <div
              *ngIf="surname.invalid && (surname.dirty || surname.touched)"
              class="alert alert-danger"
            >
              Surname is mandatory
            </div>
          </div>
          <div class="form-group">
            <label for="email">Email *</label>
            <input
              type="email"
              [(ngModel)]="user.email"
              class="form-control disabled"
              id="email"
              name="email"
              placeholder="Enter your email address"
              required
              #email="ngModel"
              [disabled]="!isNewUser()"
            />
            <div
              *ngIf="email.invalid && (email.dirty || email.touched)"
              class="alert alert-danger"
            >
              Email is mandatory
            </div>
          </div>
          <div class="form-group">
            <label for="role">Role *</label>
            <p-dropdown
              #role="ngModel"
              name="role"
              [(ngModel)]="user.role"
              [options]="roles"
              [filter]="true"
              [showClear]="true"
              placeholder="Select a role"
              [required]="true"
              [disabled]="!roles || !canManageUsers"
            >
            </p-dropdown>
            <div *ngIf="role.invalid && (role.dirty || role.touched)" class="alert alert-danger">
              Role is mandatory
            </div>
          </div>
          <div class="form-group d-flex align-items-center">
            <label for="active">Active user</label>
            <p-inputSwitch
              #active="ngModel"
              name="active"
              [(ngModel)]="user.active"
              [disabled]="!canManageUsers"
            ></p-inputSwitch>
          </div>
          <div class="form-group">
            <label for="role">Languages *</label>
            <!-- <p-dropdown
              #role="ngModel"
              name="languages"
              [(ngModel)]="user.languages"
              [options]="languages"
              [filter]="true"
              [showClear]="true"
              placeholder="Seleziona le lingue"
              [required]="true"
              [disabled]="!languages || !canManageUsers"
            >
            </p-dropdown> -->
            <p-listbox 
            [options]="languages"
            [(ngModel)]="user.languages"
            name="language"
            [metaKeySelection]="false"
            [checkbox]="true"
            [filter]="true"
            [multiple]="true"
            [disabled]="!languages || !canManageUsers"
            optionLabel="name"
            [listStyle]="{'max-height':'250px'}"
            [style]="{'width':'15rem'}">
              <ng-template let-language pTemplate="item">
                  <div class="language-item">
                      <div>{{language.name}}</div>
                  </div>
              </ng-template>
          </p-listbox>
            <!-- <div *ngIf="languages.invalid && (languages.dirty || languages.touched)" class="alert alert-danger">
              Devi selezionare almeno una lingua
            </div> -->
          </div>
          <div class="text-end">
            <button
              type="button"
              (click)="goToUserList()"
              class="btn btn-secondary ms-auto"
              [hidden]="!canManageUsers"
            >
              Cancel
            </button>
            <button
              type="submit"
              [disabled]="!userForm.form.valid"
              [hidden]="!canManageUsers"
              class="btn btn-danger ms-2">
              Save
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
